# å‘Šè­¦æœåŠ¡å·¥æ§æœºéƒ¨ç½²æŒ‡å—

## ğŸ“¦ éƒ¨ç½²æµç¨‹

### 1. æœ¬åœ°ç¯å¢ƒï¼ˆå¼€å‘æœºï¼‰

#### æ„å»ºDockeré•œåƒ
```bash
cd packages/
chmod +x build_image.sh
./build_image.sh
```

**æ„å»ºè¾“å‡ºï¼š**
- é•œåƒåç§°ï¼š`voltageems-alarmsrv:1.0.0`
- æ‰“åŒ…æ–‡ä»¶ï¼š`voltageems-alarmsrv-1.0.0.tar.gz`
- ç›®æ ‡æ¶æ„ï¼š`linux/arm64` (aarch64)

### 2. ä¼ è¾“åˆ°å·¥æ§æœº

å°†æ‰“åŒ…æ–‡ä»¶ä¼ è¾“åˆ°å·¥æ§æœºï¼š
```bash
# æ–¹å¼1ï¼šscpä¼ è¾“
scp voltageems-alarmsrv-1.0.0.tar.gz user@å·¥æ§æœºIP:/path/to/deploy/

# æ–¹å¼2ï¼šUç›˜/ç‰©ç†ä¼ è¾“
# å°†tar.gzæ–‡ä»¶å¤åˆ¶åˆ°Uç›˜ï¼Œç„¶ååœ¨å·¥æ§æœºä¸Šæ‹·è´
```

### 3. å·¥æ§æœºéƒ¨ç½²

#### åŠ è½½é•œåƒ
```bash
chmod +x load_image.sh start.sh
./load_image.sh
```

**åŠ è½½åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æŸ¥æ‰¾`voltageems-alarmsrv-*.tar.gz`æ–‡ä»¶
- åœæ­¢å¹¶åˆ é™¤ç°æœ‰å®¹å™¨å’Œé•œåƒ
- åŠ è½½æ–°é•œåƒå¹¶åˆ›å»º`latest`æ ‡ç­¾

#### å¯åŠ¨æœåŠ¡
```bash
./start.sh
```

**å¯åŠ¨åŠŸèƒ½ï¼š**
- æ™ºèƒ½é€‰æ‹©æœ€æ–°ç‰ˆæœ¬é•œåƒ
- æ£€æŸ¥Redisè¿æ¥çŠ¶æ€
- åˆ›å»ºæ•°æ®æŒä¹…åŒ–ç›®å½•
- å¯åŠ¨å®¹å™¨å¹¶éªŒè¯æœåŠ¡çŠ¶æ€

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `REDIS_HOST` | `localhost` | RedisæœåŠ¡å™¨åœ°å€ |
| `REDIS_PORT` | `6379` | Redisç«¯å£ |
| `REDIS_PREFIX` | `alarmsrv:` | Redisé”®å‰ç¼€ |
| `DATABASE_PATH` | `/app/config/voltageems-alarm.db` | SQLiteæ•°æ®åº“è·¯å¾„ |
| `DEBUG` | `false` | è°ƒè¯•æ¨¡å¼ |
| `LOG_LEVEL` | `INFO` | æ—¥å¿—çº§åˆ« |

### æ•°æ®æŒä¹…åŒ–

| å®¿ä¸»æœºè·¯å¾„ | å®¹å™¨è·¯å¾„ | ç”¨é€” |
|-----------|----------|------|
| `/extp/config/` | `/app/config/` | æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ |
| `/extp/logs/` | `/app/logs/` | æ—¥å¿—æ–‡ä»¶å­˜å‚¨ |

## ğŸš€ æœåŠ¡ä¿¡æ¯

### ç«¯å£å’Œè®¿é—®åœ°å€
- **æœåŠ¡ç«¯å£ï¼š** 6002
- **å¥åº·æ£€æŸ¥ï¼š** http://localhost:6002/health
- **APIæ–‡æ¡£ï¼š** http://localhost:6002/docs

### å®¹å™¨ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker ps | grep alarmsrv

# æŸ¥çœ‹æ—¥å¿—
docker logs voltageems-alarmsrv

# é‡å¯æœåŠ¡
docker restart voltageems-alarmsrv

# åœæ­¢æœåŠ¡
docker stop voltageems-alarmsrv

# æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
docker inspect voltageems-alarmsrv
```

## ğŸ” æ•…éšœæ’æŸ¥

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker logs voltageems-alarmsrv -f

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 6002

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a | grep alarmsrv
```

### 2. æ•°æ®åº“é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la /extp/config/voltageems-alarm.db*

# è¿›å…¥å®¹å™¨æŸ¥çœ‹
docker exec -it voltageems-alarmsrv /bin/bash
```

### 3. Redisè¿æ¥é—®é¢˜
```bash
# æµ‹è¯•Redisè¿æ¥
redis-cli ping

# æ£€æŸ¥RedisçŠ¶æ€
systemctl status redis
```

## ğŸ“Š æ•°æ®å¤‡ä»½

### å¤‡ä»½æ•°æ®åº“
```bash
# å¤‡ä»½SQLiteæ•°æ®åº“
cp /extp/config/voltageems-alarm.db /path/to/backup/voltageems-alarm-$(date +%Y%m%d).db
```

### å¤‡ä»½æ—¥å¿—
```bash
# å‹ç¼©å¤‡ä»½æ—¥å¿—
tar -czf /path/to/backup/alarmsrv-logs-$(date +%Y%m%d).tar.gz /extp/logs/
```

## ğŸ”„ ç‰ˆæœ¬å‡çº§

1. åœ¨å¼€å‘æœºæ„å»ºæ–°ç‰ˆæœ¬é•œåƒ
2. ä¼ è¾“æ–°çš„tar.gzæ–‡ä»¶åˆ°å·¥æ§æœº
3. è¿è¡Œ`./load_image.sh`åŠ è½½æ–°é•œåƒ
4. è¿è¡Œ`./start.sh`å¯åŠ¨æ–°ç‰ˆæœ¬

**æ³¨æ„ï¼š** å‡çº§è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åœæ­¢æ—§ç‰ˆæœ¬ï¼Œæ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶ä¼šä¿ç•™ã€‚

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†é’¥ï¼š** åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹`JWT_SECRET_KEY`
2. **ç½‘ç»œå®‰å…¨ï¼š** ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®6002ç«¯å£
3. **å®šæœŸå¤‡ä»½ï¼š** å»ºè®®æ¯æ—¥å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
4. **æ—¥å¿—ç›‘æ§ï¼š** å®šæœŸæ£€æŸ¥æœåŠ¡æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
5. **Rediså®‰å…¨ï¼š** ç¡®ä¿RedisæœåŠ¡é…ç½®äº†é€‚å½“çš„å®‰å…¨ç­–ç•¥

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Dockerå·²å®‰è£…å¹¶è¿è¡Œ
- [ ] RedisæœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] ç½‘ç»œ6002ç«¯å£å¯ç”¨
- [ ] `/extp/config/`å’Œ`/extp/logs/`ç›®å½•æƒé™æ­£ç¡®
- [ ] é•œåƒæ–‡ä»¶ä¼ è¾“å®Œæ•´
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸå¹¶é€šè¿‡å¥åº·æ£€æŸ¥
- [ ] APIæ¥å£å¯æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“è‡ªåŠ¨åˆ›å»ºæˆåŠŸ
